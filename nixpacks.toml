[phases.setup]
nixPkgs = ["python311", "gcc", "pkg-config", "cairo", "pango", "gdk-pixbuf", "libffi", "gobject-introspection"]

[phases.install]
dependsOn = ["setup"]
cmds = ["python -m venv .venv", ". .venv/bin/activate", "pip install -r backend/requirements.txt"]

[start]
cmd = ". .venv/bin/activate && cd backend && uvicorn app.main:app --host 0.0.0.0 --port $PORT"

# C'EST ICI LA MAGIE : On dit au compilateur o√π chercher
[variables]
PKG_CONFIG_PATH = "/usr/lib/pkgconfig:/usr/local/lib/pkgconfig:/usr/share/pkgconfig"
# On force l'utilisation des librairies Nix
NIX_CFLAGS_COMPILE = "-I/nix/store/include"
NIX_LDFLAGS = "-L/nix/store/lib"